EXPORT=DATABASE.IN:DATABASE
EXPORT=SERVER.LISTEN:PORT

## TEMPLATES

'target' -> ENCLOSING CreateListTemplate(transparency/Render)
'./templates/list.html' -> IN ReadListTemplate(filesystem/ReadFileSync) OUT -> TEMPLATE CreateListTemplate()

## DATABASE

Database(core/Split) OUT -> SERVER ReadListDb(pgorm/Read)
Database() OUT -> DATABASE GetActive(example-todo-server/Get)
Database() OUT -> SERVER UpdateDb(pgorm/Write)

## HTTP

'/list' -> MATCH ListTodos(woute/Match)
'/active' -> MATCH GetActiveTodos(woute/Match)
'/update' -> MATCH UpdateTodos(woute/Match)
'POST' -> METHOD UpdateTodos()

Server(webserver/Server) REQUEST -> IN BodyParser(webserver/BodyParser) OUT -> IN ListTodos() FAIL -> IN GetActiveTodos() FAIL -> IN UpdateTodos() FAIL -> IN Missing(woute/Match)
Output(core/Merge) OUT -> IN SendResponse(webserver/SendResponse)

# Listing TODOs

'true' -> KEEP ListQuery(cache/Cache)
'todos' -> GROUP ListTable(core/Group)
'id,LIKE,\'%%\'' -> IN ArrayifyListQuery(adapters/TupleToArray) OUT -> IN ListTable() OUT -> IN ListQuery()

'body' -> IN ArrayifyListPattern(adapters/TupleToArray) OUT -> PATTERN LiftListBody(lift/Lift)
LiftListBody() EXTOKEN -> GROUP ListToken(groups/Group)
'1' -> THRESHOLD ReadListToken()

ListTodos() OUT -> IN ListToGroups(woute/ToGroups) OUT -> IN LiftListBody() EXTRACTED -> READY ListQuery() OUT -> IN ListToken() OUT -> IN ReadListDb()
ReadListDb() ERROR -> IN ReadListDbError(core/Output)
ReadListDb() OUT -> IN ReadListToken(groups/ReadGroups)
ReadListToken() GROUP -> RETOKEN LiftListBody()
ReadListToken() OUT -> IN ArrayifyReadOutput(adapters/PacketsToArray) OUT -> IN CreateListTemplate() OUT -> RETURN LiftListBody() OUT -> IN ListFromGroups(woute/FromGroups) OUT -> IN Output()

# Getting only active TODOs

'completed,=,true' -> QUERY GetActive()
GetActiveTodos() OUT -> IN GetActive() OUT -> IN Output()

# Creating/Updating TODOs

'true' -> KEEP UpdateQuery(cache/Cache)
'todos' -> GROUP UpdateTable(core/Group)
'completed,=,true' -> IN ArrayifyUpdateQuery(adapters/TupleToArray) OUT -> IN UpdateTable() OUT -> IN UpdateQuery()

'body' -> IN ArrayifyUpdatePattern(adapters/TupleToArray) OUT -> PATTERN LiftUpdateBody(lift/Lift)
LiftUpdateBody() EXTOKEN -> GROUP UpdateToken(core/Group)
'1' -> THRESHOLD ReadUpdateToken()
'^headers$' -> REGEXP RemoveHeaders(groups/RemoveGroups)

UpdateTodos() OUT -> IN UpdateToGroups(woute/ToGroups) OUT -> IN LiftUpdateBody() EXTRACTED -> IN RemoveUpdateInputGroups(groups/RemoveGroups) OUT -> IN ConvertUpdateInput(adapters/ObjectToPackets) OUT -> IN UpdateToken() OUT -> IN UpdateDb()
UpdateDb() ERROR -> IN UpdateDbError(core/Output)
UpdateDb() OUT -> IN ReadUpdateToken(groups/ReadGroups)
ReadUpdateToken() GROUP -> RETOKEN LiftUpdateBody()
ReadUpdateToken() OUT -> IN ArrayifyUpdateOutput(adapters/PacketsToArray) OUT -> IN JsonifyUpdateOutput(strings/Jsonify) OUT -> RETURN LiftUpdateBody() OUT -> IN RemoveHeaders() OUT -> IN UpdateFromGroups(woute/FromGroups) OUT -> IN Output()

# Missing TODOs

Missing() OUT -> IN Output()
